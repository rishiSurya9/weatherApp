<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <!-- <style>
/* Container styling */
.code-box {
  background: #1e1e1e;
  color: #dcdcdc;
  padding: 12px;
  border-radius: 6px;
  font-family: Consolas, monospace;
  font-size: 14px;
  overflow-x: auto;
  margin: 10px 0;
  border: 1px solid #333;
}

.code-box pre {
  margin: 0;
}

h3 {
  margin-bottom: 4px;
  font-family: sans-serif;
}


/* Optional: syntax look (simple highlight) */
.code-box .keyword { color: #569cd6; }
.code-box .func { color: #dcdcaa; } -->

<!-- </style> -->
    <link rel="stylesheet" href="style.css" />
    <title>weather</title>
  </head>
  <body>
    <div class="container">
      <!-- <div class="header"> -->
<h3>pom.xml</h3>

<div class="code-box">
<pre><code>
//&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
    &lt;parent&gt;
        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
        &lt;version&gt;3.3.5&lt;/version&gt;   &lt;!-- change from 3.4.x --&gt;
    &lt;/parent&gt;

    &lt;groupId&gt;com.example&lt;/groupId&gt;
    &lt;artifactId&gt;blog&lt;/artifactId&gt;
    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
    &lt;name&gt;blog&lt;/name&gt;
    &lt;description&gt;Demo project for Spring Boot&lt;/description&gt;
    &lt;url/&gt;
    &lt;licenses&gt;
        &lt;license/&gt;
    &lt;/licenses&gt;
    &lt;developers&gt;
        &lt;developer/&gt;
    &lt;/developers&gt;
    &lt;scm&gt;
        &lt;connection/&gt;
        &lt;developerConnection/&gt;
        &lt;tag/&gt;
        &lt;url/&gt;
    &lt;/scm&gt;
    &lt;properties&gt;
        &lt;java.version&gt;17&lt;/java.version&gt;
    &lt;/properties&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
        &lt;/dependency&gt;

        &lt;dependency&gt;
            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
            &lt;optional&gt;true&lt;/optional&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.security&lt;/groupId&gt;
            &lt;artifactId&gt;spring-security-test&lt;/artifactId&gt;
            &lt;scope&gt;test&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
            &lt;artifactId&gt;jjwt-api&lt;/artifactId&gt;
            &lt;version&gt;0.11.5&lt;/version&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
            &lt;artifactId&gt;jjwt-impl&lt;/artifactId&gt;
            &lt;version&gt;0.11.5&lt;/version&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;
            &lt;artifactId&gt;jjwt-jackson&lt;/artifactId&gt;
            &lt;version&gt;0.11.5&lt;/version&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;annotationProcessorPaths&gt;
                        &lt;path&gt;
                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
                        &lt;/path&gt;
                    &lt;/annotationProcessorPaths&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
                &lt;configuration&gt;
                    &lt;excludes&gt;
                        &lt;exclude&gt;
                            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;
                            &lt;artifactId&gt;lombok&lt;/artifactId&gt;
                        &lt;/exclude&gt;
                    &lt;/excludes&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;

&lt;/project&gt;
</code></pre>

</div>

<h3>.properties</h3>

<div class="code-box">
<pre><code>
package com.example.blog.web;

import com.example.blog.model.Role;
import com.example.blog.model.User;
import com.example.blog.repo.UserRepo;
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;
import io.jsonwebtoken.security.Keys;
import jakarta.servlet.http.Cookie;
import jakarta.servlet.http.HttpServletResponse;
import java.security.Key;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.web.bind.annotation.*;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;

import java.util.Optional;
import java.util.Map;

import java.time.Instant;
import java.util.Date;


@RestController
@RequestMapping("/api/auth")
public class AuthController {

    private final UserRepo repo;
    private final PasswordEncoder encoder;
    private final String secret;
    private final long exp;

    public AuthController(UserRepo repo, PasswordEncoder encoder,
                          @Value("${jwt.secret}") String secret,
                          @Value("${jwt.exp}") long exp) {
        this.repo = repo;
        this.encoder = encoder;
        this.secret = secret;
        this.exp = exp;
    }

    // ----------- REGISTER -----------
    @PostMapping("/register")
    public ResponseEntity<?> register(@RequestBody Map<String,String> req){
        // check duplicate email
        if (repo.findByEmail(req.get("email")).isPresent()) {
            return ResponseEntity
                    .status(HttpStatus.CONFLICT) // 409
                    .body(Map.of("error","Email already exists"));
        }

        User u = new User();
        u.username = req.get("username");
        u.email = req.get("email");
        u.password = encoder.encode(req.get("password"));
        u.role = Role.USER;
        u.enabled = true;
        u.createdAt = Instant.now();
        u.updatedAt = Instant.now();
        repo.save(u);

        return ResponseEntity.ok(Map.of("message","registered"));
    }

    // ----------- LOGIN -----------//
    @PostMapping("/login")
    public ResponseEntity<?> login(@RequestBody Map<String,String> req, HttpServletResponse response) {
        Optional<User> opt = repo.findByEmail(req.get("email"));

        if (opt.isEmpty()) {
            return ResponseEntity
                    .status(HttpStatus.NOT_FOUND)
                    .body(Map.of("error", "User not found"));
        }

        User u = opt.get();

        if(!encoder.matches(req.get("password"), u.password)) {
            return ResponseEntity
                    .status(HttpStatus.UNAUTHORIZED)
                    .body(Map.of("error", "Bad credentials"));
        }

        byte[] keyBytes = secret.getBytes();
        Key signingKey = Keys.hmacShaKeyFor(keyBytes);

        String token = Jwts.builder()
                .setSubject(u.id)
                .setExpiration(new Date(System.currentTimeMillis() + exp))
                .signWith(signingKey, SignatureAlgorithm.HS256)
                .compact();

        // ------ SET COOKIE ------
        Cookie cookie = new Cookie("jwt", token);
        cookie.setHttpOnly(true);
        cookie.setPath("/");
        cookie.setMaxAge((int)(exp/1000));
        response.addCookie(cookie);

        return ResponseEntity.ok(Map.of("message", "logged_in"));
    }


    // ----------- GET CURRENT USER -----------
    @GetMapping("/me")
    public ResponseEntity<?> me(@RequestAttribute("uid") String uid){
        Optional<User> opt = repo.findById(uid);

        if (opt.isEmpty()) {
            return ResponseEntity
                    .status(HttpStatus.NOT_FOUND)
                    .body(Map.of("error", "User not found"));
        }

        User u = opt.get();

        if(!u.enabled) {
            return ResponseEntity
                    .status(HttpStatus.FORBIDDEN)
                    .body(Map.of("error", "User disabled"));
        }

        return ResponseEntity.ok(u);
    }
}


</code></pre>
</div>
<h3>User.java</h3>

<div class="code-box">
<pre><code>
package com.example.blog.model;
package com.example.blog.web;

import com.example.blog.model.Blog;
import com.example.blog.model.Role;
import com.example.blog.model.User;
import com.example.blog.repo.BlogRepo;
import com.example.blog.repo.UserRepo;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import java.time.Instant;
import java.util.Map;
import java.util.Optional;

@RestController
@RequestMapping("/api/blogs")
public class BlogController {

    private final BlogRepo blogRepo;
    private final UserRepo userRepo;

    public BlogController(BlogRepo blogRepo, UserRepo userRepo) {
        this.blogRepo = blogRepo;
        this.userRepo = userRepo;
    }

    // ---------------- CREATE (Authenticated)
    @PostMapping
    public ResponseEntity<?> create(@RequestBody Blog b, @RequestAttribute("uid") String uid) {

        b.id = null;
        b.authorId = uid;
        b.createdAt = Instant.now();
        b.updatedAt = Instant.now();
        blogRepo.save(b);

        return ResponseEntity
                .status(HttpStatus.CREATED)
                .body(b);
    }

    // ---------------- READ PUBLIC (BY ID)
    @GetMapping("/{id}")
    public ResponseEntity<?> getById(@PathVariable String id) {

        Optional<Blog> opt = blogRepo.findById(id);

        if(opt.isEmpty()) {
            return ResponseEntity
                    .status(HttpStatus.NOT_FOUND)
                    .body(Map.of("error","Blog not found"));
        }

        return ResponseEntity.ok(opt.get());
    }

    // ---------------- READ PUBLIC (BY SLUG)
    @GetMapping("/slug/{slug}")
    public ResponseEntity<?> getBySlug(@PathVariable String slug) {

        Optional<Blog> opt = blogRepo.findBySlug(slug);

        if(opt.isEmpty()) {
            return ResponseEntity
                    .status(HttpStatus.NOT_FOUND)
                    .body(Map.of("error","Blog not found"));
        }

        return ResponseEntity.ok(opt.get());
    }

    // ---------------- UPDATE (Owner or Admin)
    @PutMapping("/{id}")
    public ResponseEntity<?> update(@PathVariable String id,
                                    @RequestBody Blog data,
                                    @RequestAttribute("uid") String uid) {

        // Find blog
        Optional<Blog> optBlog = blogRepo.findById(id);
        if(optBlog.isEmpty()) {
            return ResponseEntity
                    .status(HttpStatus.NOT_FOUND)
                    .body(Map.of("error","Blog not found"));
        }

        // Find user
        Optional<User> optUser = userRepo.findById(uid);
        if(optUser.isEmpty()) {
            return ResponseEntity
                    .status(HttpStatus.NOT_FOUND)
                    .body(Map.of("error","User not found"));
        }

        Blog b = optBlog.get();
        User u = optUser.get();

        // Forbidden check
        if (!b.authorId.equals(uid) && u.role != Role.ADMIN) {
            return ResponseEntity
                    .status(HttpStatus.FORBIDDEN)
                    .body(Map.of("error","Forbidden"));
        }

        // Update data
        b.title = data.title;
        b.slug = data.slug;
        b.content = data.content;
        b.excerpt = data.excerpt;
        b.tags = data.tags;
        b.status = data.status;
        b.updatedAt = Instant.now();

        blogRepo.save(b);

        return ResponseEntity.ok(b);
    }

    // ---------------- DELETE (Owner or Admin)
    @DeleteMapping("/{id}")
    public ResponseEntity<?> delete(@PathVariable String id,
                                    @RequestAttribute("uid") String uid) {

        Optional<Blog> optBlog = blogRepo.findById(id);
        if(optBlog.isEmpty()) {
            return ResponseEntity
                    .status(HttpStatus.NOT_FOUND)
                    .body(Map.of("error","Blog not found"));
        }

        Optional<User> optUser = userRepo.findById(uid);
        if(optUser.isEmpty()) {
            return ResponseEntity
                    .status(HttpStatus.NOT_FOUND)
                    .body(Map.of("error","User not found"));
        }

        Blog b = optBlog.get();
        User u = optUser.get();

        if (!b.authorId.equals(uid) && u.role != Role.ADMIN) {
            return ResponseEntity
                    .status(HttpStatus.FORBIDDEN)
                    .body(Map.of("error","Forbidden"));
        }

        blogRepo.delete(b);

        return ResponseEntity.ok(Map.of("message","deleted"));
    }
}

</code></pre>
</div>
<h3>Role.java</h3>

<div class="code-box">
<pre><code>
package com.example.blog.model;

public enum Role {
    ADMIN,
    USER
}


</code></pre>
</div>
<h3>Blog.java</h3>

<div class="code-box">
<pre><code>
package com.example.blog.model;

import org.springframework.data.annotation.Id;
import org.springframework.data.mongodb.core.mapping.Document;

import java.time.Instant;
import java.util.List;

@Document("blogs")
public class Blog {

    @Id
    public String id;

    public String title;
    public String slug;
    public String content;
    public String excerpt;

    public String authorId;         // user ID
    public List<String> tags;

    public Status status = Status.DRAFT;

    public Instant createdAt = Instant.now();
    public Instant updatedAt = Instant.now();

    public enum Status {
        DRAFT, PUBLISHED
    }
}


</code></pre>
</div>
<h3>BlogRepo.java</h3>

<div class="code-box">
<pre><code>
package com.example.blog.repo;

import com.example.blog.model.Blog;
import org.springframework.data.mongodb.repository.MongoRepository;

import java.util.Optional;

public interface BlogRepo extends MongoRepository<Blog, String> {
    Optional<Blog> findBySlug(String slug);
}


</code></pre>
</div>
<h3>UserRepo.java</h3>

<div class="code-box">
<pre><code>
package com.example.blog.repo;

import com.example.blog.model.Blog;
import org.springframework.data.mongodb.repository.MongoRepository;

import java.util.Optional;

public interface BlogRepo extends MongoRepository<Blog, String> {
    Optional<Blog> findBySlug(String slug);
}


</code></pre>
</div>
<h3>JwtFilter.java</h3>

<div class="code-box">
<pre><code>
package com.example.blog.security;

import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.security.Keys;
import jakarta.servlet.*;
import jakarta.servlet.http.*;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;
import java.io.IOException;

@Component
public class JwtFilter implements Filter {

    @Value("${jwt.secret}")
    private String secret;
@Override
public void doFilter(ServletRequest req, ServletResponse res, FilterChain fc)
        throws IOException, ServletException {

    HttpServletRequest r = (HttpServletRequest) req;

    // Allow login & register
    if(r.getRequestURI().startsWith("/api/auth/login") ||
       r.getRequestURI().startsWith("/api/auth/register")) {
        fc.doFilter(req, res);
        return;
    }

    // ---- Read token from cookie ----
    String token = null;
    if(r.getCookies() != null) {
        for(Cookie c : r.getCookies()) {
            if(c.getName().equals("jwt")) {
                token = c.getValue();
            }
        }
    }

    if(token != null) {
        try {
            String uid = Jwts.parserBuilder()
                .setSigningKey(Keys.hmacShaKeyFor(secret.getBytes()))
                .build()
                .parseClaimsJws(token)
                .getBody()
                .getSubject();

            req.setAttribute("uid", uid);
        } catch (Exception ignored) {}
    }

    fc.doFilter(req, res);
}


}



</code></pre>
</div>
<h3>SecurityConfig.java</h3>

<div class="code-box">
<pre><code>
package com.example.blog.security;

import org.springframework.context.annotation.*;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.web.SecurityFilterChain;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;

@Configuration
public class SecurityConfig {

    @Bean
    public SecurityFilterChain filter(HttpSecurity http, JwtFilter f) throws Exception {
        http.csrf(cs -> cs.disable())
           .addFilterBefore(f, org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter.class)
           .authorizeHttpRequests(a -> a
                .anyRequest().permitAll()
           );
        return http.build();
    }

    @Bean
    PasswordEncoder pw(){ return new BCryptPasswordEncoder(); }
}



</code></pre>
</div>
<h3>AuthController.java</h3>

<div class="code-box">
<pre><code>
package com.example.blog.web;

import com.example.blog.model.Role;
import com.example.blog.model.User;
import com.example.blog.repo.UserRepo;
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.SignatureAlgorithm;
import io.jsonwebtoken.security.Keys;
import jakarta.servlet.http.Cookie;
import jakarta.servlet.http.HttpServletResponse;
import java.security.Key;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.web.bind.annotation.*;

import java.time.Instant;
import java.util.*;

@RestController
@RequestMapping("/api/auth")
public class AuthController {

    private final UserRepo repo;
    private final PasswordEncoder encoder;
    private final String secret;
    private final long exp;

    public AuthController(UserRepo repo, PasswordEncoder encoder,
                          @Value("${jwt.secret}") String secret,
                          @Value("${jwt.exp}") long exp) {
        this.repo = repo;
        this.encoder = encoder;
        this.secret = secret;
        this.exp = exp;
    }

    // ----------- REGISTER -----------
    @PostMapping("/register")
    public Map<String,String> register(@RequestBody Map<String,String> req){
        User u = new User();
        u.username = req.get("username");
        u.email = req.get("email");
        u.password = encoder.encode(req.get("password"));
        u.role = Role.USER;
        u.enabled = true;
        u.createdAt = Instant.now();
        u.updatedAt = Instant.now();
        repo.save(u);
        return Map.of("message","registered");
    }

    @PostMapping("/login")
public Map<String,String> login(@RequestBody Map<String,String> req, HttpServletResponse response) {
    User u = repo.findByEmail(req.get("email"))
            .orElseThrow(() -> new RuntimeException("User not found"));

    if(!encoder.matches(req.get("password"), u.password))
        throw new RuntimeException("Bad credentials");

   byte[] keyBytes = secret.getBytes();
Key signingKey = Keys.hmacShaKeyFor(keyBytes);

String token = Jwts.builder()
        .setSubject(u.id)
        .setExpiration(new Date(System.currentTimeMillis() + exp))
        .signWith(signingKey, SignatureAlgorithm.HS256)
        .compact();

    // ------ SET COOKIE ------
    Cookie cookie = new Cookie("jwt", token);
    cookie.setHttpOnly(true);
    cookie.setPath("/");
    cookie.setMaxAge((int)(exp/1000));
    response.addCookie(cookie);

    return Map.of("message", "logged_in");
}


    // ----------- GET CURRENT USER -----------
    @GetMapping("/me")
    public User me(@RequestAttribute("uid") String uid){
        User u = repo.findById(uid).orElseThrow();
        if(!u.enabled) throw new RuntimeException("USER DISABLED");
        return u;
    }
}


</code></pre>
</div>
<h3>BlogController.java</h3>

<div class="code-box">
<pre><code>
package com.example.blog.web;

import com.example.blog.model.Blog;
import com.example.blog.model.Role;
import com.example.blog.model.User;
import com.example.blog.repo.BlogRepo;
import com.example.blog.repo.UserRepo;
import org.springframework.web.bind.annotation.*;

import java.time.Instant;
import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/api/blogs")
public class BlogController {

    private final BlogRepo blogRepo;
    private final UserRepo userRepo;

    public BlogController(BlogRepo blogRepo, UserRepo userRepo) {
        this.blogRepo = blogRepo;
        this.userRepo = userRepo;
    }

    // ---------------- CREATE (Authenticated)
    @PostMapping
    public Blog create(@RequestBody Blog b, @RequestAttribute("uid") String uid) {
        b.id = null;
        b.authorId = uid;
        b.createdAt = Instant.now();
        b.updatedAt = Instant.now();
        blogRepo.save(b);
        return b;
    }

    // ---------------- READ PUBLIC (BY ID)
    @GetMapping("/{id}")
    public Blog getById(@PathVariable String id) {
        return blogRepo.findById(id).orElseThrow();
    }

    // ---------------- READ PUBLIC (BY SLUG)
    @GetMapping("/slug/{slug}")
    public Blog getBySlug(@PathVariable String slug) {
        return blogRepo.findBySlug(slug).orElseThrow();
    }

    // ---------------- UPDATE (Owner or Admin)
    @PutMapping("/{id}")
    public Blog update(@PathVariable String id, @RequestBody Blog data,
                       @RequestAttribute("uid") String uid) {

        Blog b = blogRepo.findById(id).orElseThrow();
        User u = userRepo.findById(uid).orElseThrow();

        // Owner or ADMIN only
        if (!b.authorId.equals(uid) && u.role != Role.ADMIN)
            throw new RuntimeException("Forbidden");

        b.title = data.title;
        b.slug = data.slug;
        b.content = data.content;
        b.excerpt = data.excerpt;
        b.tags = data.tags;
        b.status = data.status;
        b.updatedAt = Instant.now();

        return blogRepo.save(b);
    }

    // ---------------- DELETE (Owner or Admin)
    @DeleteMapping("/{id}")
    public Map<String,String> delete(@PathVariable String id,
                                     @RequestAttribute("uid") String uid) {

        Blog b = blogRepo.findById(id).orElseThrow();
        User u = userRepo.findById(uid).orElseThrow();

        if (!b.authorId.equals(uid) && u.role != Role.ADMIN)
            throw new RuntimeException("Forbidden");

        blogRepo.delete(b);
        return Map.of("message", "deleted");
    }
}
</code></pre>
</div>
<h3>SecurityConfig.java</h3>

<div class="code-box">
<pre><code>
package com.example.blog.config;

import lombok.RequiredArgsConstructor;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.authentication.*;
import org.springframework.security.config.annotation.authentication.configuration.AuthenticationConfiguration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.crypto.bcrypt.*;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
@RequiredArgsConstructor
public class SecurityConfig {

    @Bean
    public SecurityFilterChain filter(HttpSecurity http) throws Exception {
        http
                .csrf(csrf -> csrf.disable())
                .authorizeHttpRequests(auth -> auth
                        .requestMatchers("/api/auth/**").permitAll()
                        .anyRequest().authenticated()
                );

        return http.build();
    }

    @Bean
    public AuthenticationManager authManager(AuthenticationConfiguration cfg) throws Exception {
        return cfg.getAuthenticationManager();
    }

    @Bean
    public PasswordEncoder encoder() {
        return new BCryptPasswordEncoder();
    }
}



</code></pre>
</div>
<!-- 

        <i class="fa-solid fa-location-dot fa-bounce icon" style="color: #1dd110;"></i>
        <input
          type="text"
          placeholder="Enter city name"
          class="input-box"
        />
        <button
          class="searchBtn fa-solid fa-magnifying-glass icon2"
          value="ok"
        ></button>
      </div>
      <div class="location-error">
        <h1>Sorry Location not found!!</h1>
        <img src="error.webp" alt="404 error">
      </div>
      <div class="w-body">
      <div class="img">
        <img src="sun.webp" alt="Weather Image" class="weather-img"/>
        <div class="TD">
          <p class="temperature">0 <sup>Â°C</sup></p>
          <p class="description">Light Rain</p>
        </div>
      </div>
      <div class="details">
        <div class="humid">
          <i class="fa-solid fa-droplet fa-fade" style="color: #1a5fd5"></i>

          <div class="text">
            <p class="humidity">20%</p>
            <p class="humidity">Humidity</p>
          </div>
        </div>
        <div class="windS">
          <i class="fa-solid fa-wind fa-flip"
                style="color: rgb(72, 223, 243)"
               ></i>
              <div class="text">
                <p class="wind">12Km\h</p>
                 <p class="wind">Wind Speed</p>
              </div>
         </div>
      </div>
    </div> 
    </div>
    <div class="dev"><p >By</p>
      <p class="maker">Rushikesh Gajanan Suryawanshi</p> -->
    </div>
    <script src="script.js"></script>
  </body>
</html>
